# Postfix Main Configuration
# Generated by Ansible

# Basic settings
myhostname = mail-srv.{{ domain }}
mydomain = {{ domain }}
myorigin = $mydomain
inet_interfaces = all
inet_protocols = ipv4

# Network
mynetworks = 127.0.0.0/8, 192.168.1.0/24, 172.16.1.0/24, 10.0.0.0/24

# Mail delivery
mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
home_mailbox = Maildir/

# SMTP Authentication via LDAP
smtpd_sasl_type = dovecot
smtpd_sasl_path = private/auth
smtpd_sasl_auth_enable = yes
smtpd_sasl_security_options = noanonymous
broken_sasl_auth_clients = yes

# TLS/SSL
smtpd_use_tls = yes
smtpd_tls_cert_file = /etc/ssl/lksn-ca/certs/mail-srv.crt
smtpd_tls_key_file = /etc/ssl/lksn-ca/private/mail-srv.key
smtpd_tls_CAfile = /etc/ssl/lksn-ca/certs/ca.crt
smtpd_tls_security_level = may
smtpd_tls_loglevel = 1

# SMTP restrictions
smtpd_recipient_restrictions =
    permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination
